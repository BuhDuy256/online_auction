@startuml MainUseCaseDiagram
' --- Cài đặt Sơ đồ ---
' Sơ đồ vẽ từ trái sang phải
left to right direction

' Tùy chỉnh giao diện (tùy chọn)
skinparam actorStyle awesome
skinparam usecase {
    BackgroundColor PaleGreen
    BorderColor Green
}
skinparam rectangle {
    BorderColor RoyalBlue
    BackgroundColor WhiteSmoke
}

' --- 1. Định nghĩa Actors ---
actor "Người dùng nặc danh" as Guest
actor "Người mua (Bidder)" as Bidder
actor "Người bán (Seller)" as Seller
actor "Quản trị viên" as Admin

' --- 2. Định nghĩa Quan hệ Kế thừa (Inheritance) ---
' Một Bidder là một Guest
Bidder --|> Guest
' Một Seller là một Bidder
Seller --|> Bidder

' --- 3. Gói Use Cases (System Boundary) ---
rectangle "Hệ thống Sàn Đấu Giá Trực Tuyến" {

    ' --- UCs cho Guest (và các roles kế thừa) ---
    usecase "(UC-03) Tìm kiếm sản phẩm" as UC_Search
    usecase "(UC-04) Xem chi tiết sản phẩm" as UC_ViewDetail
    usecase "Xem danh sách sản phẩm" as UC_ViewList
    usecase "(UC-01) Đăng ký tài khoản" as UC_Register
    usecase "(UC-02) Đăng nhập" as UC_Login

    ' --- UCs cho Bidder (và các roles kế thừa) ---
    usecase "(UC-05) Ra giá" as UC_Bid
    usecase "(UC-06) Thêm vào Watch List" as UC_Watchlist
    usecase "(UC-07) Hỏi & Đáp sản phẩm" as UC_QnA
    usecase "Xin nâng cấp lên Seller" as UC_RequestUpgrade

    ' --- UCs cho Seller ---
    usecase "(UC-08) Đăng sản phẩm đấu giá" as UC_PostItem
    usecase "Quản lý sản phẩm (của mình)" as UC_ManageItems

    ' --- UCs Tương tác (Bidder & Seller) ---
    usecase "(UC-12) Hoàn tất đơn hàng" as UC_CompleteOrder
    usecase "(UC-11) Đánh giá người dùng" as UC_Review
    usecase "(UC-13) Chat đơn hàng" as UC_Chat

    ' --- UCs cho Admin ---
    usecase "(UC-09) Quản lý Danh mục" as UC_ManageCat
    usecase "Quản lý Người dùng" as UC_ManageUser
    usecase "(UC-10) Duyệt nâng cấp tài khoản" as UC_ApproveUpgrade
    usecase "Gỡ bỏ/Quản lý Sản phẩm" as UC_ManageAllItems

    ' --- Các UCs mở rộng (extends) ---
    usecase "Đăng nhập Social" as UC_SocialLogin
    usecase "Quên mật khẩu" as UC_ForgotPass
}

' --- 4. Kết nối Actor với Use Case ---

' Guest Connections
Guest -- UC_ViewList
Guest -- UC_Search
Guest -- UC_ViewDetail
Guest -- UC_Register
Guest -- UC_Login

' Bidder Connections (chỉ các UCs mới, vì đã kế thừa từ Guest)
Bidder -- UC_Bid
Bidder -- UC_Watchlist
Bidder -- UC_QnA
Bidder -- UC_RequestUpgrade

' Seller Connections (chỉ các UCs mới, vì đã kế thừa từ Bidder)
Seller -- UC_PostItem
Seller -- UC_ManageItems
' Seller cũng tham gia vào QnA (để trả lời)
Seller -- UC_QnA

' Bidder & Seller Connections (Tương tác chung)
Bidder -- UC_CompleteOrder
Seller -- UC_CompleteOrder
Bidder -- UC_Review
Seller -- UC_Review
Bidder -- UC_Chat
Seller -- UC_Chat

' Admin Connections
Admin -- UC_ManageCat
Admin -- UC_ManageUser
Admin -- UC_ManageAllItems

' --- 5. Định nghĩa Quan hệ giữa các Use Case (Relationships) ---

' Đăng nhập Social và Quên mật khẩu là các "extends" của Đăng nhập
UC_Login <.. UC_SocialLogin : <<extends>>
UC_Login <.. UC_ForgotPass : <<extends>>

' Đánh giá người dùng là một phần "bắt buộc" (include) sau khi Hoàn tất đơn hàng
UC_CompleteOrder .> UC_Review : <<include>>

' Chat đơn hàng được sử dụng trong quá trình Hoàn tất đơn hàng
UC_CompleteOrder .> UC_Chat : <<include>>

' Duyệt nâng cấp là một trường hợp "mở rộng" (extends) của Quản lý người dùng
UC_ManageUser <.. UC_ApproveUpgrade : <<extends>>

' Admin duyệt (ApproveUpgrade) các yêu cầu do Bidder gửi (RequestUpgrade)
' (Đây là một lưu ý logic, không phải là quan hệ <<include>> hay <<extends>>)
UC_ApproveUpgrade .. UC_RequestUpgrade : (liên quan)

@enduml
